
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Dynamically Pre-Render Images - Michael Minter</title>
  <meta name="author" content="<a href="http://github.com/michaelminter" target="_blank" class="github_link">Michael Minter</a>">

  
  <meta name="description" content="If you’ve been frustrated with having to resize images for the sake of continuity or load time and don’t want to develop an entire caching system &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://moorberry.net/blog/content-delivery-network">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/bootstrap/bootstrap.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/bootstrap/responsive.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/syntax/syntax.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/custom.css" media="screen, projection" rel="stylesheet" type="text/css">
  
  <script src="/javascripts/libs/jquery.js"></script>
  <script src="/javascripts/libs/modernizr-2.0.js"></script>
  <script src="/javascripts/libs/bootstrap.js"></script>
  <script src="/javascripts/libs/bootstrap-dropdown.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Michael Minter" type="application/atom+xml">
  <script type="text/javascript">
  $('.dropdown-toggle').dropdown();
</script>

  

</head>

<body   >
  <nav role="navigation"><div class="navbar">
  <div class="navbar-inner">
    <div class="container">
      <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </a>

      <a class="brand" href="/">Michael Minter</a>

      <div class="nav-collapse">
        <ul class="nav">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li class="dropdown" id="menu1">
    <a class="dropdown-toggle" data-toggle="dropdown" href="#menu1">
      Categories
      <b class="caret"></b>
    </a>
    <ul class="dropdown-menu">
      <li><a href="/blog/categories/php">PHP</a></li>
      <li><a href="/blog/categories/ruby">Ruby</a></li>
    </ul>
  </li>
  <li class="divider-vertical"></li>
  <li><a href="http://github.com/michaelminter" target="_blank">github</a></li>
  <li><a href="http://twitter.com/mothore" target="_blank">@mothore</a></li>
  <li><a href="/assets/michael_minter_resume.pdf" target="_blank">Resume</a></li>
</ul>


        <ul class="nav pull-right" data-subscription="rss">
          <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
          
        </ul>

        
          <form class="pull-right navbar-search" action="http://google.com/search" method="get">
            <fieldset role="search">
              <input type="hidden" name="q" value="site:moorberry.net" />
              <input class="search-query" type="text" name="q" results="0" placeholder="Search"/>
            </fieldset>
          </form>
        
      </div>
    </div>
  </div>
</div>
</nav>
  <div class="container">
    <div class="row-fluid">
      
<article class="hentry span9" role="article">

  
  <header class="page-header">
    
      <h1 class="entry-title">Dynamically Pre-Render Images</h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-04-22T10:48:00-05:00" pubdate data-updated="true">Apr 22<span>nd</span>, 2010</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>If you’ve been frustrated with having to resize images for the sake of continuity or load time and don’t want to develop an entire caching system than this post will be of great value to you.</p>

<p>Today I will discusses the theory and resolve of applying a system to autonomously resize images, with the GD library for PHP, before they get requested by the browser.</p>

<p>This practice presents many benefits to its use.</p>

<ul>
<li>Save loads of hard drive space</li>
<li>Easy to resize div backgrounds</li>
<li>Faster to call than the use of <a href="/blog/server-vs-client">JavaScript</a>.</li>
</ul>


<h2>Calling the Application With HTML</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">&quot;image.php?i=image.jpg&amp;s=500&quot;</span> <span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Calling the php script is this easy. You can place this tag anywhere on any page and be able to display an image, with exact value constraints, and as many times as you need.</p>

<h2>Developing the image.php Application</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='perl'><span class='line'><span class="n">header</span><span class="p">(</span><span class="s">&quot;Content-Type: image/jpeg&quot;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>header() will make sure that the browser is aware how to handle the applicaton. Here it enables the page to be viewed as a jpeg source.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='perl'><span class='line'><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s">&#39;s&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span><span class='line'>    <span class="nv">$size</span> <span class="o">=</span> <span class="mi">160</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>    <span class="nv">$size</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s">&#39;s&#39;</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nv">$image</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s">&#39;i&#39;</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="n">list</span><span class="p">(</span><span class="nv">$width</span><span class="p">,</span> <span class="nv">$height</span><span class="p">)</span> <span class="o">=</span> <span class="n">getimagesize</span><span class="p">(</span><span class="nv">$image</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$ratio</span> <span class="o">=</span> <span class="nv">$width</span><span class="o">/</span><span class="nv">$height</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="nv">$ratio</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nv">$newWidth</span>  <span class="o">=</span> <span class="nv">$size</span><span class="p">;</span>
</span><span class='line'>    <span class="nv">$newHeight</span> <span class="o">=</span> <span class="nv">$size</span><span class="o">/</span><span class="nv">$ratio</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>    <span class="nv">$newHeight</span> <span class="o">=</span> <span class="nv">$size</span><span class="p">;</span>
</span><span class='line'>    <span class="nv">$newWidth</span>  <span class="o">=</span> <span class="nv">$size</span><span class="o">*</span><span class="nv">$ratio</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1"># creates a copy of the loaded image</span>
</span><span class='line'><span class="nv">$create</span> <span class="o">=</span> <span class="n">imagecreatefromjpeg</span><span class="p">(</span><span class="nv">$image</span><span class="p">);</span>
</span><span class='line'><span class="c1"># creates a blank template to work from</span>
</span><span class='line'><span class="nv">$template</span> <span class="o">=</span> <span class="n">imagecreatetruecolor</span><span class="p">(</span><span class="nv">$newWidth</span><span class="p">,</span><span class="nv">$newHeight</span><span class="p">);</span>
</span><span class='line'><span class="c1"># copies the original onto the new template</span>
</span><span class='line'><span class="n">imagecopyresized</span><span class="p">(</span><span class="nv">$template</span><span class="p">,</span> <span class="nv">$create</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$newWidth</span><span class="p">,</span> <span class="nv">$newHeight</span><span class="p">,</span> <span class="nv">$width</span><span class="p">,</span> <span class="nv">$height</span><span class="p">);</span>
</span><span class='line'><span class="c1"># displays the image</span>
</span><span class='line'><span class="n">ImageJpeg</span><span class="p">(</span><span class="nv">$template</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Usually I break this larger portion of my post up into smaller pieces so I can reference all the code being used and what it does. But the fundamentals are so well noted and easy to navigate, that I figured even if I left it as so, that you should have no problem implementing this into your own work.</p>

<h2>Error catching</h2>

<p>If source material is not working properly. Issue the following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='perl'><span class='line'><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">function_exists</span><span class="p">(</span><span class="s">&#39;imagecreatetruecolor&#39;</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>    <span class="nb">exit</span><span class="p">(</span><span class="s">&#39;Err, function : imagecreatetruecolor does not exist&#39;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>function_exists() will check the currently active Apache function repository, both internal and user-defined, to see if the listed function matches anything available.</p>

<p>If you’re receiving the error message than the server you’re running this code on does not support the GD library and you must either set it up manually or contact an administrator to do so for you.</p>

<p>Also note that only Jpeg formats are acceptable by this set up. Extending is not a difficult task. I only wanted you to understand the basics and be able to evolve with PHP from my writings.</p>

<h2>Summary</h2>

<p>Hopefully I’ve left more than enough room for you to adapt this into your own projects. You can add on to this with many of the GD library features documented by the PHP network.</p>

<p>If you develop an extension or even a class, from these tips, please feel free to share by commenting back and letting me know what you’ve done.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn"><a href="http://github.com/michaelminter" target="_blank" class="github_link">Michael Minter</a></span></span>

      








  


<time datetime="2010-04-22T10:48:00-05:00" pubdate data-updated="true">Apr 22<span>nd</span>, 2010</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/php/'>PHP</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    
    <section>
      <h1>Comments</h1>
      <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
    </section>
    
    <ul class="pager">
      
      <li class="previous"><a class="basic-alignment left"
        href="/blog/paypal-express-checkout-nvp-api/" title="Previous Post:
        Bare Bones Paypal Express Checkout NVP API">&laquo; Bare Bones Paypal Express Checkout NVP API</a></li>
      
      <li><a href="/blog/archives">Blog Archives</a></li>
      
      <li class="next"><a class="basic-alignment right" href="/blog/export-csv/"
        title="Next Post: Export CSV">Export CSV
        &raquo;</a></li>
      
    </ul>
  </footer>
</article>

<aside class="sidebar-nav span3">
  
    <section class="well">
  <ul id="recent_posts" class="nav nav-list">
    <li class="nav-header">Recent Posts</li>
    
      <li class="post">
        <a href="/blog/html-not-rendering-in-gmail/">HTML Not Rendering in Gmail</a>
      </li>
    
      <li class="post">
        <a href="/blog/export-csv/">Export CSV</a>
      </li>
    
      <li class="post">
        <a href="/blog/content-delivery-network/">Dynamically Pre-Render Images</a>
      </li>
    
      <li class="post">
        <a href="/blog/paypal-express-checkout-nvp-api/">Bare Bones Paypal Express Checkout NVP API</a>
      </li>
    
      <li class="post">
        <a href="/blog/server-vs-client/">Server vs Client</a>
      </li>
    
  </ul>
</section>
<section class="well">
  <ul class="nav"><li class="nav-header">Recent Comments</li></ul>
  <div id="dsq-recentcomments" class="dsq-widget"><script type="text/javascript" src="http://disqus.com/forums/michaelminter/recent_comments_widget.js"></script></div>
</section>





<section class="well" id="coderwall">
  <ul class="nav"><li class="nav-header">Coderwall Badges</li></ul>
  <div id="coderwall_container">
    <script type="text/javascript">
      function display_coderwall(args) {
        var badges = args["data"]["badges"];
        var wall = '';
        for ( var i = 0; i < badges.length; i++ ) {
          var alt_txt   = badges[i]["name"];
          var title_txt = badges[i]["name"] + ' - ' + badges[i]["description"];
          wall += '<a href="http://coderwall.com/michaelminter/"><img src="'
            + badges[i]["badge"]
            + '" width="48" height="48" alt="' + alt_txt
            + '" title="' + title_txt
            + '"/></a>';
        }
        document.write(wall);
      }
    </script>
    <script src="http://coderwall.com/michaelminter.json?callback=display_coderwall"></script>
    
    <br /><br />
    
    
    <p><a href="http://coderwall.com/michaelminter"><img src="http://api.coderwall.com/michaelminter/endorsecount.png" /></a></p>
    
  </div>
</section>
<section id="google_adspace">
  <script type="text/javascript">
    google_ad_client = "ca-pub-7424434269432645";
    /* Blog - Sidebar */
    google_ad_slot = "3122450024";
    google_ad_width = 120;
    google_ad_height = 600;
  </script>
  <script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script>
</section>
  
</aside>


    </div>
  </div>
  <footer role="contentinfo" class="page-footer"><hr>
<p>
  Copyright &copy; 2012 - <a href="http://github.com/michaelminter" target="_blank" class="github_link">Michael Minter</a> -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'michaelminter';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://moorberry.net/blog/content-delivery-network/';
        var disqus_url = 'http://moorberry.net/blog/content-delivery-network/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
